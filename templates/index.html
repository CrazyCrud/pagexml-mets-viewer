{% extends 'base.html' %}

{% block head %}
<title>PageXML Viewer</title>
{% endblock %}

{% block body %}

<section class="section pt-2">
    <div class="container">
        <h1 class="title">PAGE-XML Viewer</h1>
        <p class="subtitle">Upload PAGE-XML files, add images, then Commit.</p>

        <!-- Workspace -->
        <div id="wsBox" class="box" style="display:none;">
            <p class="mb-2"><strong>Workspace-ID on server:</strong> <span id="wsIdTag" class="tag is-info"></span></p>
            <div class="buttons">
                <button id="btnCommit" class="button is-success" disabled>Commit</button>
                <button id="btnReset" class="button is-light">Start Over</button>
            </div>
            <p id="commitNotice" class="help is-success" style="display:none;">Committed âœ“</p>
        </div>

        <!-- Upload PageXML files -->
        <div class="box">
            <h2 class="title is-5">1. Upload PAGE-XML files</h2>
            <form id="formPages">
                <div class="file has-name is-fullwidth">
                    <label class="file-label">
                        <input id="pagesInput" class="file-input" type="file" name="files[]" multiple accept=".xml">
                        <span class="file-cta">
              <span class="file-icon">ðŸ“„</span>
              <span class="file-label">Choose PAGE-XML filesâ€¦</span>
            </span>
                        <span id="pagesInputName" class="file-name">No files selected</span>
                    </label>
                </div>
                <div class="mt-3">
                    <button class="button is-link" type="submit">Upload PAGE-XML</button>
                </div>
            </form>
            <p id="pagesUploadMsg" class="help mt-2"></p>
        </div>

        <!-- Add images and upload -->
        <div class="box" id="imagesBox" style="display:none;">
            <h2 class="title is-5">2. Upload images</h2>
            <div id="missingWrap" class="content">
                <p><strong>Missing images:</strong></p>
                <ul id="missingList"></ul>
            </div>
            <form id="formImages" class="mt-3">
                <div class="file has-name is-fullwidth">
                    <label class="file-label">
                        <input id="imagesInput" class="file-input" type="file" name="files[]" multiple
                               accept=".tif,.tiff,.png,.jpg,.jpeg,.bmp,.webp,.gif">
                        <span class="file-cta">
              <span class="file-icon">ðŸ–¼</span>
              <span class="file-label">Choose imagesâ€¦</span>
            </span>
                        <span id="imagesInputName" class="file-name">No files selected</span>
                    </label>
                </div>
                <div class="mt-3">
                    <button class="button is-primary" type="submit">Upload images</button>
                </div>
            </form>
            <p id="imagesUploadMsg" class="help mt-2"></p>
        </div>

        <!-- Page list -->
        <div class="box" id="pagesBox" style="display:none;">
            <h2 class="title is-5">3. Open a PAGE</h2>
            <div class="table-container">
                <table class="table is-fullwidth is-striped is-hoverable">
                    <thead>
                    <tr>
                        <th>File</th>
                    </tr>
                    </thead>
                    <tbody id="pagesTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Viewer -->
        <div class="box" id="viewerBox" style="display:none;">
            <h2 class="title is-5">Viewer</h2>
            <p class="mb-2"><strong>PAGE:</strong> <span id="curPage"></span></p>
            <div id="stats-panel" class="box" style="margin-top:.75rem; display:none;">
                <div id="stats-content"></div>
            </div>
            <div class="content">
                <canvas id="pageCanvas" style="max-width:100%; border:1px solid #ddd;"></canvas>
            </div>
            <div class="field is-grouped is-grouped-multiline">
                <div class="control"><label class="checkbox"><input type="checkbox" id="cbRegions" checked> Show regions</label>
                </div>
                <div class="control"><label class="checkbox"><input type="checkbox" id="cbLines" checked> Show
                    lines</label></div>
            </div>
        </div>

    </div>
</section>

{% endblock %}